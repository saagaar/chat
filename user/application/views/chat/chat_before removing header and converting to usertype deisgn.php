<!DOCTYPE html>
<html>
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<meta content="width=device-width, initial-scale=1.0" name="viewport">
	<title>freelance Guru</title>
	
	<link href="https://fonts.googleapis.com/css?family=Bitter:400,700%7COpen+Sans:400,600i,700,800%7CRaleway:400,500i,700,800,900" rel="stylesheet">

	<!-- <link href="css/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css"> -->
	<link href="<?php echo base_url('assets/'); ?>css/font-awesome.min.css" media="screen" rel="stylesheet" type="text/css">
	<link href="<?php echo base_url('assets/'); ?>css/chatboard.css" media="screen" rel="stylesheet" type="text/css">
	<!-- <link href="<?php echo base_url('assets/'); ?>css/plugin.css" media="screen" rel="stylesheet" type="text/css">
	<link href="<?php echo base_url('assets/'); ?>css/custom.css" media="screen" rel="stylesheet" type="text/css">
	<link href="<?php echo base_url('assets/'); ?>css/colors.css" media="screen" rel="stylesheet" type="text/css">
	<link href="<?php echo base_url('assets/'); ?>css/style.css" media="screen" rel="stylesheet" type="text/css">
	<link href="<?php echo base_url('assets/'); ?>css/style2.css" media="screen" rel="stylesheet" type="text/css">
	<link href="<?php echo base_url('assets/'); ?>css/style3.css" media="screen" rel="stylesheet" type="text/css">

	<!-- update css indra2017 -->
	<link href="<?php echo base_url('assets/'); ?>css/main.css" media="screen" rel="stylesheet" type="text/css">

	<link href="<?php echo base_url('assets/'); ?>img/favicon.png" rel="shortcut icon">
	<link href="<?php echo base_url('assets/'); ?>img/favicon.png" rel="icon">

	
</head>
<body>
	

<!--  <link href="<?php echo base_url('assets/'); ?>css/bootstrap.min.css" rel="stylesheet" type="text/css" media="all" />
 <link href="<?php echo base_url('assets/'); ?>css/font-awesome.min.css" rel="stylesheet" type="text/css" media="all" />
 <link href="<?php echo base_url('assets/'); ?>css/flag-icon.min.css" rel="stylesheet" type="text/css" media="all" />	 -->
<header class="set-scrol-bt" id="header">
		<div class="header-top">
			<div class="wrapper">
				<div class="container">
					<div class="pull-left">
						<ul class="contact-bar">
							<li>
								<div class="flag">
									<a data-target="#langmodal" data-toggle="modal" href="index.html#"><span class="flag-icon flag-icon-us"></span> English</a>
								</div>
							</li>
						</ul>
					</div><!--first-menu-->
					<div class="bs-navigation col-md-8">
						<ul>
							<li class="notifications-dropdown"><a href="index.html#"><i aria-hidden="true" class="fa fa-address-card"></i>Client ID</a></li>
							<li class="notifications-dropdown">
								<a class="btn-notification dropdown-toggle" data-toggle="dropdown" href="index.html#"><span class="noty-bubble">2</span> <i aria-hidden="true" class="fa fa-exclamation-triangle"></i>Report</a>
								<div class="dropdown-menu notifications-tabs">
									<div>
										<div class="message-list-container">
											<h4>You have 2 new Report</h4>
											<ul class="clearfix">
												<li class="clearfix"><a class="message-thumb" href="index.html#"><img alt="image" src="<?php echo base_url('assets/'); ?>img/avatar/robertoortiz.jpg"></a> <a class="message-intro" href="index.html#"><span class="message-meta">Robertoortiz</span> Nunc aliquam dolor... <span class="message-time">today at 10:20 pm</span></a></li>
												<li class="clearfix"><a class="message-thumb" href="index.html#"><span class="message-letter w_bg_purple">A</span></a> <a class="message-intro" href="index.html#"><span class="message-meta">Allisongrayce</span> In hac habitasse ... <span class="message-time">today at 8:29 pm</span></a></li>
											</ul>
										</div>
									</div>
								</div>
							</li>
							<li class="notifications-dropdown"><a class="btn-notification dropdown-toggle" data-toggle="dropdown" href="index.html#"><span class="noty-bubble">2</span> <i aria-hidden="true" class="fa fa-cart-plus"></i>Sales</a></li>
							<li class="notifications-dropdown">
								<a class="btn-notification dropdown-toggle" data-toggle="dropdown" href="index.html#"><span class="noty-bubble">15</span> <i aria-hidden="true" class="fa fa-envelope-open-o"></i>Messages</a>
								<div class="dropdown-menu notifications-tabs">
									<div>
										<div class="message-list-container">
											<h4>You have 15 new messages</h4>
											<ul class="clearfix">
												<li class="clearfix"><a class="message-thumb" href="index.html#"><img alt="image" src="<?php echo base_url('assets/'); ?>img/avatar/robertoortiz.jpg"></a> <a class="message-intro" href="index.html#"><span class="message-meta">Robertoortiz</span> Nunc aliquam dolor... <span class="message-time">today at 10:20 pm</span></a></li>
												<li class="clearfix"><a class="message-thumb" href="index.html#"><span class="message-letter w_bg_purple">A</span></a> <a class="message-intro" href="index.html#"><span class="message-meta">Allisongrayce</span> In hac habitasse ... <span class="message-time">today at 8:29 pm</span></a></li>
												<li class="clearfix"><a class="message-thumb" href="index.html#"><img alt="image" src="<?php echo base_url('assets/'); ?>img/avatar/michael-owens.jpg"></a> <a class="message-intro" href="index.html#"><span class="message-meta">Michael</span> Suspendisse ac mauris ... <span class="message-time">yesterday at 12:29 pm</span></a></li>
												<li class="clearfix"><a class="message-thumb" href="index.html#"><span class="message-letter w_bg_blue">B</span></a> <a class="message-intro" href="index.html#"><span class="message-meta">Bobbyjkane</span> Vivamus lacinia facilisis... <span class="message-time">yesterday at 11:48 pm</span></a></li>
												<li class="clearfix"><a class="message-thumb" href="index.html#"><img alt="image" src="<?php echo base_url('assets/'); ?>img/avatar/bobbyjkane.jpg"></a> <a class="message-intro" href="index.html#"><span class="message-meta">Bobbyjkane</span> Donec vel iaculis ... <span class="message-time">1 month ago</span></a></li>
												<li class="clearfix"><a class="message-thumb" href="index.html#"><span class="message-letter w_bg_teal">C</span></a> <a class="message-intro" href="index.html#"><span class="message-meta">Chexee</span> Curabitur eget blandit...<span class="message-time">3 months ago</span></a></li>
												<li class="clearfix"><a class="message-thumb" href="index.html#"><img alt="image" src="<?php echo base_url('assets/'); ?>img/avatar/coreyweb.jpg"></a> <a class="message-intro" href="index.html#"><span class="message-meta">Coreyweb</span> Etiam molestie nulla... <span class="message-time">1 year ago</span></a></li>
											</ul>
										</div>
									</div>
								</div>
							</li>
							<li class="notifications-dropdown"><a class="btn-notification dropdown-toggle" data-toggle="dropdown" href="index.html#"><span class="noty-bubble">2</span> <i aria-hidden="true" class="fa fa-bell"></i>Job Offer</a></li>
							<li class="notifications-dropdown"><a class="btn-notification dropdown-toggle" data-toggle="dropdown" href="index.html#"><span class="noty-bubble">2</span> <i aria-hidden="true" class="fa fa fa-info-circle"></i>Info</a></li>
						</ul>
					</div>
					<div class="pull-right login-section">
						<div class="top-nav notification-row">
							<!-- notificatoin dropdown start-->
							<ul class="nav pull-right top-menu set-bs-menu">
								<li class="dropdown">
									<ul class="dropdown-menu extended logout">
										<li style="list-style: none; display: inline">
											<div class="log-arrow-up"></div>
										</li>
										<li class="eborder-top"><a href="index.html#"><i class="fa fa-user-o"></i>My Profile</a></li>
										<li><a href="index.html#"><i class="fa fa-key"></i> Settings</a></li>
										<li><a href="index.html#"><i class="fa fa-key"></i> Logout</a></li>
									</ul>
									<a class="dropdown-toggle" data-toggle="dropdown" href="index.html#"><span class="profile-ava"><img alt="" src="<?php echo base_url('assets/'); ?>img/avatar1_small.jpg"></span> <span class="username">Jenifer Smith</span> <b class="caret"></b></a>
									
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</header>	
	<div class="wrapper">
		<div class="container">
			<div class="desh-content">
				<div class="row">
					<div class="afix-content client-desh">
						<div class="sidebar-afix affix nicescroll-rails client-desh-left" style="border-right: 2px solid #E0E4DD;">
							<div class="col-sm-12 col-xs-12 col-md-12 no-padding">
								<div class="main-content">
									<div class="tab-section">
										<div class="row">
											<div class="col-md-12 col-sm-12 col-xs-12">
												<div class="fixed-left">
													<div class="new-chat">
														<div class="avatar">
															<img src="<?= PROFILE_PICTURE_PATH.$userid.'/'.$profilePicture;?>" alt="profile picture">
															<span class="online">‚óè</span>
														</div>
														<div class="status">
															<ul>
																<li>
																	<a href="#" class="active">
																		<i class="fa fa-address-book-o" aria-hidden="true"></i>
																	</a>
																</li>
															</ul>
														</div>
													</div>
													<form method="post" action="#">
														<div class="form-group searching-box" style="border:none;">
															<input type="text" class="form-control filtername" placeholder="Search User">
															 <button class="btn btn-pink filteroptname" data-searchtype="user" data-searchurl="<?php echo CHAT_MODULE.'get_user_search'?>">
															<span class="glyphicon glyphicon-search" aria-hidden="true"></span>
															</button>
														</div>
													</form>
												</div>
											</div>
											<div class="allcontentuser">
											<?php 
										
										
											foreach ($allchatroom as $value):
												$jobtitle=	$value[0]->job_name;
											?>
											<div class="col-md-12 col-sm-12 col-xs-12 search-result">
													<h5 class="jobtitle"><?php echo str_pad(substr($jobtitle, 0,25), 28,'...');?> </h5>
													<div class="bhoechie-tab-menu menubr">
														<div class="list-group">
															<ul class=" companylist">
											<?php 
												foreach ($value as $eachvalue):
													$companyname=$eachvalue->company_name;
													$image='';//$eachvalue->photo;
											
											?>
												
																<li style="cursor:pointer" data-url="<?php echo CHAT_MODULE.'ajax_chat_history' ?>" class="company jobmsglisting <?php if($chatroomid!='') echo 'active';?>" data-roomid="<?php echo $eachvalue->roomid;?>" >
																	<div class="avatar">
																		<img src="<?=USER_PROFILE_PICTURE_PATH.'/'.$eachvalue->profile_picture;?>" alt="Profile picture">
																		<span class="online">‚óè</span>
																	</div>
																	<div class="details">
																		<h5><?php echo $companyname;?></h5>
																		<!-- <h6>15.07.2017</h6> -->
																	</div>
																	<span class="notification"><?php echo $eachvalue->messagecount?></span>
																	<div class="notifications-dropdown">
																		<a href="#" class="btn-notification dropdown-toggle  moreinfo" data-toggle="dropdown">
																		<span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
																		</a>
																		<div class="dropdown-menu notifications-tabs">
																			<ul>
																				<li><a href="#"><i class="fa fa-lock" aria-hidden="true"></i> Block</a></li>
																				<li><a href="#"><i class="fa fa-thumbs-down" aria-hidden="true"></i> Report</a></li>
																				<li><a href="#"><i class="fa fa-heart" aria-hidden="true"></i> Favourite</a></li>
																			</ul>
																		</div>
																	</div>
																</li>
															
											<?php 
												endforeach;
											?>
													</ul>

																	
																</div>
															</div>
														</div>
											<?php
											endforeach;?>
								</div>
									
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="col-md-9 col-sm-9 col-xs-9 pull-right no-padding">
							<div class="border-box">
								<div class="main-content">
									<div class="tab-section">
										<div class="row">
											<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 bhoechie-tab-container main-box">
												<div class=" bhoechie-tab">
													<div class="bhoechie-tab-content">
														<div>
															<ul class="nav nav-tabs mainnav" role="tablist">
																<li <?php if($view=='userprofile') echo 'class="active"'?>  style="border-left:1px solid #e0e4dd;" role="presentation"><a  aria-controls="Profile" data-toggle="tab" href="index.html#Profile" role="tab"><i class="fa fa-id-card-o" aria-hidden="true"></i> User Profile</a></li>
																<!-- <li style="border-left:1px solid #e0e4dd;" role="presentation"><a  aria-controls="Profile" data-toggle="tab" href="index.html#Profile" role="tab"><i class="fa fa-id-card-o" aria-hidden="true"></i> Client Profile</a></li> -->
																<li <?php if($view=='jobdetails') echo 'class="active"'?>  role="presentation"><a aria-controls="Statics" data-toggle="tab" href="index.html#Statics" role="tab"><i class="fa fa-terminal" aria-hidden="true"></i> Job Details</a></li>
																<li <?php if($view=='chat') echo 'class="active"'?> role="presentation"><a aria-controls="chatHistory" class="chatHistoryTab"  data-toggle="tab" href="<?php echo CHAT_MODULE;?>" role="tab"><i class="fa fa-comments-o" aria-hidden="true"></i> Chat History</a></li>
															</ul>
															<div class="tab-content">
																<div class="tab-pane " id="Statics" role="tabpanel">
																</div>
																<div class="tab-pane" id="Portfolio" role="tabpanel">
																</div>
																<div class="tab-pane" id="OurFollower" role="tabpanel">
																</div>
																<div class="tab-pane"  <?php if($view=='userprofile') echo 'active';?> id="Profile" role="tabpanel">
																	<div class="tab-main-content">
																		<div class="row">
																			<div class="col-md-12 col-sm-12 col-xs-12">
																				<div class="picprofile" style="background-image:url(<?=base_url('assets/user/')?>img/index.jpg)">
																					<!--
																					<div class="picgraycolor">
																						<input id="imgupload" style="display:none" type="file"><i aria-hidden="true" class="fa fa-camera caproimg1" onclick="$('#imgupload').trigger('click'); return false;"></i>
																					</div>
																					-->
																					<div class="imgusersa imgusersa-circle" style="">
																						<div class="framesa" style="background-image:url(<?=base_url('assets/user/')?>img/pro.jpg)">
																							<!--
																							<div class="upload">
																								<input id="imgupload2" style="display:none" type="file"><i aria-hidden="true" class="fa fa-camera caproimg" onclick="$('#imgupload2').trigger('click'); return false;"></i>
																							</div>
																							-->
																						</div>
																					</div>
																					<h2 class="card-title">Pamela Anderson</h2>
																				</div>
																				<div class="main-content">
																					<div class="tab-section">
																						<div class="row">
																							<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
																								<div class=" bhoechie-tab">
																									<div class="bhoechie-tab-content active">
																										<div>
																											<ul class="nav nav-tabs subnav" role="tablist">
																												<li class="" role="presentation"><a aria-controls="" aria-expanded="false" data-toggle="tab" href="index.html#myprofile" role="tab"><i aria-hidden="true" class="fa fa-briefcase"></i>Current Job</a></li>
																												<li class="" role="presentation"><a aria-controls="" aria-expanded="false" data-toggle="tab" href="index.html#payment" role="tab"><i aria-hidden="true" class="fa fa-pencil-square-o"></i>Current Contracts</a></li>
																												<li class="" role="presentation"><a aria-controls="" aria-expanded="false" data-toggle="tab" href="index.html#compsaswda" role="tab"><i aria-hidden="true" class="fa fa-star-half-o"></i>Reviews</a></li>
																												<!-- <li class="" role="presentation"><a aria-controls="" aria-expanded="false" data-toggle="tab" href="index.html#ownerinfo" role="tab"><i aria-hidden="true" class="fa fa-facebook"></i>Social Logins</a></li>
																												<li class="" role="presentation"><a aria-controls="" aria-expanded="false" data-toggle="tab" href="index.html#Securityques" role="tab"><i aria-hidden="true" class="fa fa-shield"></i>Security Questions</a></li> -->
																											</ul>
																											<div class="tab-content">
																												<div class="tab-pane active" id="myprofile" role="tabpanel">
																												</div>
																												<div class="tab-pane" id="payment" role="tabpanel">
																												</div>
																												<div class="tab-pane" id="compsaswda" role="tabpanel">
																												</div>
																												<div class="tab-pane" id="ownerinfo" role="tabpanel">
																												</div>
																												<div class="tab-pane" id="Securityques" role="tabpanel">
																												</div>
																											</div>
																										</div>
																									</div>
																								</div>
																							</div>
																						</div>
																					</div>
																				</div>
																			</div>
																		</div>
																	</div>
																</div>

																<!-- CHAT HISTORY -->
														<div class="tab-pane <?php if($view=='chat') echo 'active';?>" id="chatHistory" role="tabpanel">
															<!-- <div class="chatHistory"> -->

															<?php 

															if($view=='chat'):?>
																<!-- CHAT HISTORY -->
																<div class="tab-pane <?php if($view=='chat') echo 'active';?>" id="chatHistory" role="tabpanel">
																	<div class="chatHistory filterviewchat">
																	<?php $this->load->view('chat/ajax_chat_history');?>
																	</div>
																	
																</div>
															<?php endif;?>
															<!-- </div> -->
														
														</div>
																<!-- /.CHAT HISTORY -->
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<footer style="border: 2px solid #E0E4DD;">
									<div class="container">
										<div class="row">
											<div class="col-md-10 col-xs-10" style="padding:0 0px 0px 10px;">
												<form method="post" id="chat-form">
													<div class="form-group message-box">
														<textarea class="form-control" rows="1" name="message" id="message" placeholder="Message"></textarea>
														<button type="submit" style="appearance: none;-webkit-appearance: none;-moz-appearance: none;outline: none;border: 0;background: transparent;">
														<i class="fa fa-paper-plane" aria-hidden="true"></i>
														</button>
													</div>
												</form>
											</div>
											<div class="col-md-2 col-xs-2 upload-box text-center">
												<button id="open_btn" class="btn btn-primary"><i class="fa fa-upload" aria-hidden="true"></i></button>
											</div>
										</div>
									</div>
								</footer>
							</div>
						</div>
						<div class="sidebar-afix affix nicescroll-rails client-desh" style="border-left: 2px solid #E0E4DD;">
							<div class="col-sm-12 col-xs-12 col-md-12 no-padding">
								<div class="main-content">
									<div class="tab-section">
										<div class="row">
											<div class="col-md-12 col-sm-12 col-xs-12">
												<div class="fixed-right">
													<form method="post" action="#">
													<div class="form-group searching-box ">

														<input type="text" class="form-control filtername" placeholder="Search Documents">
														
														<!-- <span class="glyphicon glyphicon-search search-document searchoptbtn" aria-hidden="true"></span> -->
														<button class="btn btn-pink filteroptname" data-searchtype="document" data-searchurl="<?php echo CHAT_MODULE.'search_document'?>"><span class="glyphicon glyphicon-search" aria-hidden="true"></span>
														</button>
													</div>
													</form>
													<div class="searching-box-type">
														<ul>
															<li >
																
																<a href="#" class="filteroptname documenttype" data-searchtype="document" data-filetype="docx" data-searchurl="<?php echo CHAT_MODULE.'search_document'?>"  data-toggle="tab">
																	<i class="fa fa-file-word-o" aria-hidden="true"></i>
																</a>
															</li>
															<li>
																<a href="#" class="filteroptname documenttype" data-searchtype="document" data-filetype="img" data-searchurl="<?php echo CHAT_MODULE.'search_document'?>"  data-toggle="tab">
																	<i class="fa fa-picture-o" aria-hidden="true"></i>
																</a>
															</li>
															<li>
															<a href="#" class="filteroptname documenttype" data-searchtype="document" data-searchurl="<?php echo CHAT_MODULE.'search_document'?>" data-filetype="all" data-toggle="tab">
																	<i class="fa fa-link" aria-hidden="true"></i>
																</a>
															</li>
														</ul>
													</div>
												</div>
											</div>
											<div class="col-md-12 col-sm-12 col-xs-12 search-result">
												<div class="bhoechie-tab-menu menubr">
													<div class="list-group">
														<div class="tab-content">
																<div class="tab-pane active" id="tab_default_1">

																	<div class="padding10">
																		<div class="mybox allcontent">
																		<?php 
																		if($documentlist):
																		foreach($documentlist as $eachdocument):?>
																		<div class="media">
																		  <div class="pull-left">
																		    <a href="#">
																		     <i class="fa fa-paperclip" aria-hidden="true"></i>
																		    </a>
																		  </div>
																		  <div class="media-body">
																		    <h4 class="media-heading">
																		     <a href="<?php echo CHAT_UPLOADS.$eachdocument->url;?>" download>
																		    <?php echo str_pad(substr($eachdocument->url, 0,15), 17,'...')?> 
																		    </a>
																		    <span class="pull-right"><?php echo $this->general->time_elapsed_string($eachdocument->created_at);?></span></h4>

																		  </div>
																		</div>
																	<?php endforeach;
																	
																	else:
																	?>
																		No documents found
																	<?php
																	endif;
																	?>
																		
																		</div>
																	</div>


																</div>
															
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div aria-labelledby="myModalLabel" class="modal fade" id="langmodal" role="dialog" tabindex="-1">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button aria-label="Close" class="close" data-dismiss="modal" type="button"><span aria-hidden="true">√ó</span></button>
						<h4 class="modal-title" id="myModalLabel">Select your Favorite Language</h4>
					</div>
					<div class="modal-body text-center">
						<a class="flags activeflag" href="#">
							<div class="flag-icon flag-icon-us flag-big"></div><br>
							English<span><i class="fa fa-fw fa-check-circle"></i></span>
						</a>
						<a class="flags" href="#">
							<div class="flag-icon flag-icon-in flag-big"></div><br>
							Hindi<span><i class="fa fa-fw fa-check-circle"></i></span>
						</a>
						<a class="flags" href="#">
							<div class="flag-icon flag-icon-ch flag-big"></div><br>
							China<span><i class="fa fa-fw fa-check-circle"></i></span>
						</a>
						<a class="flags" href="#">
							<div class="flag-icon flag-icon-af flag-big"></div><br>
							Afria<span><i class="fa fa-fw fa-check-circle"></i></span>
						</a>
					</div>
				</div>
			</div>
		</div>
		<div aria-labelledby="myModalLabel" class="modal fade" id="langmodal" role="dialog" tabindex="-1">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button aria-label="Close" class="close" data-dismiss="modal" type="button"><span aria-hidden="true">√ó</span></button>
						<h4 class="modal-title" id="myModalLabel">Select your Favorite Language</h4>
					</div>
					<div class="modal-body text-center">
						<a class="fl
						ags activeflag" href="index.html#"></a>
						<div class="flag-icon flag-icon-us flag-big"></div><br>
						English<span><i class="fa fa-fw fa-check-circle"></i></span> <a class="flags" href="index.html#"></a>
						<div class="flag-icon flag-icon-in flag-big"></div><br>
						Hindi<span><i class="fa fa-fw fa-check-circle"></i></span> <a class="flags" href="index.html#"></a>
						<div class="flag-icon flag-icon-ch flag-big"></div><br>
						China<span><i class="fa fa-fw fa-check-circle"></i></span> <a class="flags" href="index.html#"></a>
						<div class="flag-icon flag-icon-af flag-big"></div><br>
						Afria<span><i class="fa fa-fw fa-check-circle"></i></span>
					</div>
				</div>
			</div>
		</div>
	</div>
		<script>
		var m_base_url = '<?=base_url()?>';
		var CHAT_UPLOADS='<?php echo CHAT_UPLOADS;?>';
		// var conn = new WebSocket('ws://127.0.0.1:8081');
		var c_user = 'client';
	</script>
	<script src="<?=base_url('assets/')?>js/jquery.min.js" type="text/javascript"></script>
	<script src="<?=base_url('assets/')?>js/jquery.cookie.js" type="text/javascript"></script>
	<script src="<?=base_url('assets/')?>js/chat/app.js" type="text/javascript"></script>
	<script src="<?=base_url('assets/users/')?>js/plugin.js" type="text/javascript"></script>
	<script src="<?=base_url('assets/')?>js/bootstrap.min.js" type="text/javascript">
	</script>
	<script src="https://cloud.tinymce.com/stable/tinymce.min.js">
	</script>
	<script src="<?=base_url('assets/')?>js/index.js" type="text/javascript">
	</script>
	
	<!-- update js indra2017 -->
	<script src="<?=base_url('assets/')?>js/chat/main.js" type="text/javascript"></script>
		<script>

		$('body').on('click','.save',function(e){
		$('input', $(this).parent().parent()).each(function () {
		var x = $(this);
		/*console.log(x);*/
		var id =  x.attr('id');
		var v = x.val();
		var input = "<div class='form-value'><span id='"+id+"'>"+v+"</span></div>";
		x.parent().replaceWith(input);

		});
		  var edit = "<a href='javascript:void(0)' class='edit'>Edit</a>";
		  $(this).parent('.sc_btn').replaceWith(edit);

		});

		$('body').on('click','.edit',function(){
		  $('span', $(this).parent()).each(function () {
		   var x = $(this);
		   /*console.log(x);*/
		   var id =  x.attr('id');
		   var v = x.text();
		  /* console.log(v);*/
		   var span = "<input type='text' class='form-control' name='"+id+"' id='"+id+"' value='"+v+"'>";
		   var hidden_el = "<span style='display:none;' class='or_value' id='"+id+"'>"+v+"</span>"
		   x.replaceWith(span+hidden_el);
		 /* console.log(x);*/
		});
		  var save_cancel = "<div class='sc_btn'><a href='javascript:void(0)' class='save'>Save</a> <a href='javascript:void(0)' class='cancel'> cancel</a></div>";
		  $(this).replaceWith(save_cancel);

		});

		$('body').on('click','.cancel',function(e){
		$('.or_value', $(this).parent().parent()).each(function () {
		   var x = $(this);
		   var id =  x.attr('id');
		   var v = x.text();
		   var input = "<div class='form-value'><span id='"+id+"'>"+v+"</span></div>";
		   x.parent('div').replaceWith(input);
		});

		  var edit = "<a href='javascript:void(0)' class='edit'>Edit</a>";
		  $(this).parent('.sc_btn').replaceWith(edit);
		});


		</script>

	<script src="<?=base_url('assets/user/')?>js/fileupload.js" type="text/javascript"></script>
	<script type="text/javascript">
        $("#open_btn").click(function() {
        	var chatroom=$("#chatroomid").val();
			var messagesList = $('.chatHistory');
			$.FileDialog({multiple: true,accept:'image/*'}).on('files.bs.filedialog', function(ev) {
				var files = ev.files;
				var text = "";
				files.forEach(function(f) {
					// mfiles
					var formData = new FormData();
					formData.append('file',f);

					text += f.name + "<br/>";

					$.ajax({
					    url: m_base_url+'index.php/message/upload_file',
					    type: 'POST',
					    async: false,
					    data: formData,
					    processData: false,
					    contentType: false,
					    success:function(data){
							
			    		message = {
								sender: 2,
								receiver: 2,
								jobid:1,
								type: 'file',
								send_by:'c',
								chatroom:chatroom,
								url: data
							};
						// var conn = new ab.Session('ws://127.0.0.1:8081',
		    //     			function() {
					 //            conn.subscribe(chatroom, function(topic, data) {
					 //                // This is where you would add the new article to the DOM (beyond the scope of this tutorial)
					 //               	console.log(data.text);

					 //            });
					            conn.publish(chatroom,message,true);
					             // conn.publish('kittensCategory',[1, 2, 3],{foo: "bar"},{exclude_me:true});
					     //    },
					     //    function() {
					     //        console.warn('WebSocket connection closed');
					     //    },

					     //    {'skipSubprotocolCheck': true}
					    	// );
							messagesList.append(
								'<div class="col-md-12">' +
								   '<div class="message_send clearfix">' +

								      '<div class="post_avatar ">'+
										'<div class="post_avatar_link" style="background-image: url(https://66.media.tumblr.com/avatar_a648d19f0830_64.png);"><span class="online">‚óè</span></div>'+
										'</div>'+

								      '<div class="message_details img_message">' +
								         '<img id="chatImg" src="'+m_base_url+'assets/upload/'+data+'" alt="Trolltunga, Norway" width="300" height="200">' +
								         '<!-- The Modal -->' +
								         '<div id="chatImgModal" class="modal">' +
								            '<img class="modal-content" id="imgurl" style="overflow: hidden; outline: none;" tabindex="2">' +
								            '<div id="caption"></div>' +
								            '<span class="close">√ó</span>' +
								            '<div id="ascrail2003" class="nicescroll-rails" style="width: 5px; z-index: 1; cursor: default; position: absolute; top: 0px; left: 275px; height: 180px; display: none;">' +
								               '<div style="position: relative; top: 0px; float: right; width: 5px; height: 0px; background-color: rgb(154, 192, 52); border: 0px solid rgb(255, 255, 255); background-clip: padding-box; border-radius: 0px;"></div>' +
								            '</div>' +
								            '<div id="ascrail2003-hr" class="nicescroll-rails" style="height: 5px; z-index: 1; top: 175px; left: 0px; position: absolute; cursor: default; display: none;">' +
								               '<div style="position: absolute; top: 0px; height: 5px; width: 0px; background-color: rgb(154, 192, 52); border: 0px solid rgb(255, 255, 255); background-clip: padding-box; border-radius: 0px;"></div>' +
								            '</div>' +
								         '</div>' +
								      '</div>' +
								   '</div>' +
								'</div>'
							);

							var scrollBottom = $(window).scrollTop() + $(window).height();
							$('body, html').animate({scrollTop:scrollBottom});

					    }
					});

				});
				$("#output").html(text);
			}).on('cancel.bs.filedialog', function(ev) {
				$("#output").html("Cancelled!");
			});
		});
	</script>
	<script>
        // Get the modal
        // var modal = document.getElementById('chatImgModal');

        // // Get the image and insert it inside the modal - use its "alt" text as a caption
        // var img = document.getElementById('chatImg');
        // var modalImg = document.getElementById("img01");
        // var captionText = document.getElementById("caption");

        // var span = document.getElementsByClassName("close")[0];
        // img.onclick = function(){
        //     modal.style.display = "block";
        //     modalImg.src = this.src;
        //     captionText.innerHTML = this.alt;
        //     span.onclick = function() {
        //         modal.style.display = "none";
        //     }
        // }

        // Get the <span> element that closes the modal


        // When the user clicks on <span> (x), close the modal


var profile_picture_url='<?php echo USER_PROFILE_PICTURE_PATH?>';
	var chatroom=$("#chatroomid").val();

        var conn = new ab.Session('ws://127.0.0.1:8081',
		        function() {
		            conn.subscribe(chatroom, function(topic, data) {

		            	console.log('connected to chat room');
		            	var image_url = m_base_url+'assets/upload/'+data.url;
		            	
		                if (data.type=='message')
				    	{
					        messagesList.append(
								'<div class="col-md-12">'+
								'<div class="message_received clearfix">'+
									'<div class="post_avatar ">'+
										'<div class="post_avatar_link" style="background-image: url(https://secure.assets.tumblr.com/images/anonymous_avatar_64.gif);"><span class="online">‚óè</span></div>'+
									'</div>'+
									'<div class="message_details text_message">'+
										'<p>'+data.text+'</p>'+
									'</div>'+
								'</div>'+
							'</div>'
							);
						}
						else if (data.type=='file' && data.url.match(/.(jpg|jpeg|png|gif)$/i))
						{

							messagesList.append(
												'<div class="col-md-12">' +
												   '<div class="message_received clearfix">' +

												      '<div class="post_avatar ">'+
														'<div class="post_avatar_link" style="background-image: url(https://secure.assets.tumblr.com/images/anonymous_avatar_64.gif);"><span class="online">‚óè</span></div>'+
														'</div>'+

												      '<div class="message_details img_message">' +
												      	'<a href="'+m_base_url+'assets/upload/'+data.url+'" download>'+
												        	 '<img id="chatImg" src="'+m_base_url+'assets/upload/'+data.url+'" alt="Trolltunga, Norway" width="300" height="200">' +
												         '</a>'+
												         '<!-- The Modal -->' +
												      '</div>' +
												   '</div>' +
												'</div>'
											);
							
						}
						else
						{
							messagesList.append(
							'<div class="col-md-12">'+
								'<div class="message_received clearfix">'+
									'<div class="post_avatar ">'+
										'<div class="post_avatar_link" style="background-image: url(https://secure.assets.tumblr.com/images/anonymous_avatar_64.gif);"><span class="online">‚óè</span></div>'+
									'</div>'+
									'<div class="message_details text_message">'+
										'<p><a href="'+image_url+'" download>'+data.url+'</a></p>'+
									'</div>'+
								'</div>'+
							'</div>'
							);	
						}

		            });
		        },
		        function() {
		            console.warn('WebSocket connection closed');
		        },

		        {'skipSubprotocolCheck': true}
		    );
	var CHAT_MODULE='<?php echo CHAT_MODULE;?>';

	</script>

</body>
</html>